# Story 1.2: Data Loading & Exploratory Data Analysis

## Status: Draft

## Assigned To: Mario

## Story

**As a** data scientist,
**I want** the `dynamic_pricing.xlsx` dataset loaded and analyzed,
**so that** I understand the data distribution before building models.

## Acceptance Criteria

1. Dataset placed in `/backend/data/dynamic_pricing.xlsx`
2. Data loading utility created in `backend/src/ml/preprocessor.py`
3. EDA documents generated: row count, column types, missing values, descriptive statistics
4. Feature distributions analyzed (histograms for numeric, value counts for categorical)
5. Supply/demand ratio calculated as derived feature: `drivers / riders`
6. EDA summary exportable as JSON via utility function
7. Data quality issues documented in code comments or separate markdown

## Tasks / Subtasks

- [ ] Task 1: Set up data directory and load dataset (AC: 1, 2)
  - [ ] Create `backend/data/` directory structure
  - [ ] Place `dynamic_pricing.xlsx` in `backend/data/`
  - [ ] Create `backend/src/ml/__init__.py`
  - [ ] Create `backend/src/ml/preprocessor.py` with `load_dataset()` function
  - [ ] Implement Excel file loading using pandas

- [ ] Task 2: Implement EDA analysis functions (AC: 3, 4)
  - [ ] Create `get_basic_stats()` function returning row count, column types, missing values
  - [ ] Create `get_descriptive_stats()` function for numeric columns
  - [ ] Create `get_feature_distributions()` function for value counts
  - [ ] Document all data quality issues found in comments

- [ ] Task 3: Implement derived features (AC: 5)
  - [ ] Add `supply_demand_ratio` calculation (`Number_of_Drivers / Number_of_Riders`)
  - [ ] Handle edge cases (division by zero)

- [ ] Task 4: Create JSON export utility (AC: 6, 7)
  - [ ] Create `get_eda_summary()` function returning JSON-serializable dict
  - [ ] Include all stats in exportable format
  - [ ] Create `backend/data/eda_summary.json` output option

- [ ] Task 5: Write unit tests
  - [ ] Test data loading function
  - [ ] Test stats calculations
  - [ ] Test JSON export format

## Dev Notes

### Data Schema (from docs/architecture/database-schema.md)
The `dynamic_pricing.xlsx` dataset contains ride-sharing pricing data with columns:
- Number_of_Riders (int): Demand indicator
- Number_of_Drivers (int): Supply indicator
- Location_Category (str): Urban/Suburban/Rural
- Customer_Loyalty_Status (str): Bronze/Silver/Gold/Platinum
- Number_of_Past_Rides (int): Customer history
- Average_Ratings (float): Driver rating
- Time_of_Booking (str): Time category
- Vehicle_Type (str): Economy/Premium
- Expected_Ride_Duration (int): Minutes
- Historical_Cost_of_Ride (float): Baseline price

### File Location
- Dataset: `backend/data/dynamic_pricing.xlsx`
- Preprocessor: `backend/src/ml/preprocessor.py`

### Libraries to Use
- pandas 2.2 for data loading and analysis
- numpy for calculations

### JSON Output Format
```python
{
    "row_count": int,
    "column_count": int,
    "columns": {
        "column_name": {
            "dtype": str,
            "missing_count": int,
            "unique_count": int
        }
    },
    "numeric_stats": {
        "column_name": {
            "mean": float,
            "std": float,
            "min": float,
            "max": float
        }
    },
    "categorical_distributions": {
        "column_name": {"value": count}
    }
}
```

### Testing

- Test file: `backend/tests/unit/test_ml/test_preprocessor.py`
- Use pytest fixtures for test data
- Test edge cases like missing values, empty dataset

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-02 | 1.0 | Initial story creation | SM Agent |

## Dev Agent Record

### Agent Model Used
(To be filled by Dev Agent)

### Debug Log References
(To be filled by Dev Agent)

### Completion Notes List
(To be filled by Dev Agent)

### File List
(To be filled by Dev Agent)

## QA Results
(To be filled by QA Agent)

