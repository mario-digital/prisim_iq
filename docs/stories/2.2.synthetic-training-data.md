# Story 2.2: Synthetic Training Data Generation

## Status: Draft

## Assigned To: Mario

## Story

**As a** data scientist,
**I want** synthetic demand labels generated for the entire dataset,
**so that** I have labeled training data.

## Acceptance Criteria

1. For each row in dataset, generate demand at multiple price points (e.g., 10 price levels)
2. Price points span reasonable range (e.g., $5 to $100 in $10 increments)
3. Training dataset includes: context features, price, simulated demand, calculated profit
4. Profit calculated as `(price - cost) * demand`
5. Train/test split (80/20) with stratification by segment
6. Data saved to `/backend/data/processed/training_data.parquet`
7. Generation reproducible with random seed (default: 42)

## Tasks / Subtasks

- [ ] Task 1: Create data generation script (AC: 1, 7)
  - [ ] Create `backend/scripts/generate_training_data.py`
  - [ ] Set random seed for reproducibility (default: 42)
  - [ ] Load original dataset using preprocessor

- [ ] Task 2: Generate price points (AC: 2)
  - [ ] Define price range: $5 to $100
  - [ ] Create 10 price levels at $10 increments
  - [ ] Or use percentage-based: 50%, 75%, 100%, 125%, 150% of historical cost

- [ ] Task 3: Generate demand labels (AC: 1, 3)
  - [ ] For each row, iterate through price points
  - [ ] Call demand_simulator.simulate_demand() for each price
  - [ ] Store context features + price + demand

- [ ] Task 4: Calculate profit (AC: 4)
  - [ ] Add profit column: `(price - historical_cost) * demand`
  - [ ] Handle edge cases (negative profit possible)

- [ ] Task 5: Split and save data (AC: 5, 6)
  - [ ] Create `backend/data/processed/` directory
  - [ ] Stratified split by segment (80/20)
  - [ ] Save to `training_data.parquet`
  - [ ] Save test set to `test_data.parquet`
  - [ ] Log dataset statistics

- [ ] Task 6: Create utility functions
  - [ ] `load_training_data()` function
  - [ ] `load_test_data()` function
  - [ ] Data validation checks

- [ ] Task 7: Write tests
  - [ ] Test data generation produces correct shape
  - [ ] Test profit calculation
  - [ ] Test reproducibility with seed

## Dev Notes

### Data Generation Process
```python
# For each original row, generate multiple price-demand pairs
original_rows = 1000  # example
price_points = 10
generated_rows = 1000 * 10 = 10,000

# Output columns
columns = [
    # Original context features
    "number_of_riders", "number_of_drivers", "location_category",
    "customer_loyalty_status", "number_of_past_rides", "average_ratings",
    "time_of_booking", "vehicle_type", "expected_ride_duration",
    "historical_cost_of_ride", "segment",
    # Generated columns
    "price",           # The tested price point
    "demand",          # Simulated demand at this price
    "profit"           # (price - cost) * demand
]
```

### Price Point Strategy
```python
# Option 1: Fixed range
price_points = [5, 15, 25, 35, 45, 55, 65, 75, 85, 95]

# Option 2: Relative to historical cost (preferred)
def get_price_points(historical_cost: float) -> list[float]:
    multipliers = [0.5, 0.75, 0.9, 1.0, 1.1, 1.25, 1.5, 1.75, 2.0, 2.5]
    return [historical_cost * m for m in multipliers]
```

### File Locations
- Script: `backend/scripts/generate_training_data.py`
- Output: `backend/data/processed/training_data.parquet`
- Test set: `backend/data/processed/test_data.parquet`

### Running the Script
```bash
cd backend
python scripts/generate_training_data.py --seed 42
```

### Testing

- Test file: `backend/tests/unit/test_scripts/test_generate_training_data.py`
- Test shape: output rows = input rows Ã— price points
- Test columns exist
- Test reproducibility: same seed = same output

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-02 | 1.0 | Initial story creation | SM Agent |

## Dev Agent Record

### Agent Model Used
(To be filled by Dev Agent)

### Debug Log References
(To be filled by Dev Agent)

### Completion Notes List
(To be filled by Dev Agent)

### File List
(To be filled by Dev Agent)

## QA Results
(To be filled by QA Agent)

