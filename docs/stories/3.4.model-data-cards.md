# Story 3.4: Model Cards & Data Cards

## Status: Draft

## Assigned To: Mario

## Story

**As an** auditor,
**I want** standardized documentation of models and data,
**so that** I can assess reliability and compliance.

## Acceptance Criteria

1. **Model Card** per model (Random Forest, Decision Tree, Linear Regression) following Google Model Cards format
2. Each card includes: model details, intended use, training data summary, performance metrics, ethical considerations, limitations
3. **Data Card** for `dynamic_pricing.xlsx` dataset: source, features, distributions, known biases
4. Cards stored as JSON in `backend/data/cards/`
5. Cards renderable as Markdown for documentation display
6. Cards include generation timestamps and model versions

## Tasks / Subtasks

- [ ] Task 1: Create cards module (AC: 1, 4)
  - [ ] Create `backend/data/cards/` directory
  - [ ] Create `backend/scripts/generate_cards.py`
  - [ ] Define card schemas

- [ ] Task 2: Implement Model Card template (AC: 1, 2)
  - [ ] Follow Google Model Cards format
  - [ ] Include all required sections
  - [ ] Add PrismIQ-specific fields

- [ ] Task 3: Generate XGBoost model card (AC: 1, 2, 6)
  - [ ] Model details (architecture, hyperparameters)
  - [ ] Training data summary
  - [ ] Performance metrics (R², MAE, RMSE)
  - [ ] Intended use and limitations

- [ ] Task 4: Generate Decision Tree model card (AC: 1, 2, 6)
  - [ ] Model details (max_depth, etc.)
  - [ ] Performance comparison
  - [ ] Interpretability notes

- [ ] Task 5: Generate Linear Regression model card (AC: 1, 2, 6)
  - [ ] Coefficients documentation
  - [ ] Baseline comparison
  - [ ] Limitations

- [ ] Task 6: Generate Data Card (AC: 3)
  - [ ] Dataset source and description
  - [ ] Feature documentation
  - [ ] Statistical distributions
  - [ ] Known biases and limitations

- [ ] Task 7: Implement Markdown rendering (AC: 5)
  - [ ] JSON to Markdown conversion
  - [ ] Utility function for API
  - [ ] Template-based rendering

- [ ] Task 8: Write tests
  - [ ] Test card generation
  - [ ] Test JSON structure
  - [ ] Test Markdown rendering

## Dev Notes

### Model Card Schema (Google Format)
```python
class ModelCard(BaseModel):
    # Metadata
    model_name: str
    model_version: str
    generated_at: datetime
    
    # Model Details
    model_details: ModelDetails
    
    # Intended Use
    intended_use: IntendedUse
    
    # Training Data
    training_data: TrainingDataSummary
    
    # Performance
    metrics: PerformanceMetrics
    
    # Ethical Considerations
    ethical_considerations: EthicalConsiderations
    
    # Limitations
    limitations: list[str]
    
class ModelDetails(BaseModel):
    architecture: str  # "XGBoost Gradient Boosting"
    hyperparameters: dict[str, Any]
    training_date: datetime
    framework: str  # "scikit-learn 1.5"
    
class IntendedUse(BaseModel):
    primary_use: str
    users: list[str]
    out_of_scope: list[str]
    
class PerformanceMetrics(BaseModel):
    r2_score: float
    mae: float
    rmse: float
    test_set_size: int
```

### Data Card Schema
```python
class DataCard(BaseModel):
    dataset_name: str
    version: str
    generated_at: datetime
    
    # Source
    source: DataSource
    
    # Features
    features: list[FeatureDescription]
    
    # Statistics
    statistics: DatasetStatistics
    
    # Known Issues
    known_biases: list[str]
    limitations: list[str]
    
class DataSource(BaseModel):
    origin: str  # "Kaggle Dynamic Pricing Dataset"
    collection_date: str
    preprocessing_steps: list[str]
    
class FeatureDescription(BaseModel):
    name: str
    dtype: str
    description: str
    range: str | None
    distribution: str  # "normal", "uniform", "categorical"
```

### File Locations
- Cards directory: `backend/data/cards/`
- XGBoost card: `backend/data/cards/xgboost_model_card.json`
- Decision Tree card: `backend/data/cards/decision_tree_model_card.json`
- Linear Regression card: `backend/data/cards/linear_regression_model_card.json`
- Data card: `backend/data/cards/dynamic_pricing_data_card.json`

### Markdown Rendering
```python
def render_model_card_markdown(card: ModelCard) -> str:
    return f"""
# Model Card: {card.model_name}

**Version:** {card.model_version}
**Generated:** {card.generated_at}

## Model Details

- **Architecture:** {card.model_details.architecture}
- **Framework:** {card.model_details.framework}
- **Training Date:** {card.model_details.training_date}

### Hyperparameters

{format_hyperparameters(card.model_details.hyperparameters)}

## Intended Use

{card.intended_use.primary_use}

**Target Users:** {', '.join(card.intended_use.users)}

**Out of Scope:** {', '.join(card.intended_use.out_of_scope)}

## Performance Metrics

| Metric | Value |
|--------|-------|
| R² Score | {card.metrics.r2_score:.4f} |
| MAE | {card.metrics.mae:.4f} |
| RMSE | {card.metrics.rmse:.4f} |

## Ethical Considerations

{card.ethical_considerations}

## Limitations

{format_list(card.limitations)}
"""
```

### Testing

- Test file: `backend/tests/unit/test_scripts/test_generate_cards.py`
- Test JSON file created
- Test all required fields present
- Test Markdown renders without error

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-02 | 1.0 | Initial story creation | SM Agent |

## Dev Agent Record

### Agent Model Used
(To be filled by Dev Agent)

### Debug Log References
(To be filled by Dev Agent)

### Completion Notes List
(To be filled by Dev Agent)

### File List
(To be filled by Dev Agent)

## QA Results
(To be filled by QA Agent)

