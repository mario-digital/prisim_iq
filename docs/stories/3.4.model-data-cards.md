# Story 3.4: Model Cards & Data Cards

## Status: Done

## Assigned To: Mario R

## Story

**As an** auditor,
**I want** standardized documentation of models and data,
**so that** I can assess reliability and compliance.

## Acceptance Criteria

1. **Model Card** per model (Random Forest, Decision Tree, Linear Regression) following Google Model Cards format
2. Each card includes: model details, intended use, training data summary, performance metrics, ethical considerations, limitations
3. **Data Card** for `dynamic_pricing.xlsx` dataset: source, features, distributions, known biases
4. Cards stored as JSON in `backend/data/cards/`
5. Cards renderable as Markdown for documentation display
6. Cards include generation timestamps and model versions

## Tasks / Subtasks

- [x] Task 1: Create cards module (AC: 1, 4)
  - [x] Create `backend/data/cards/` directory
  - [x] Create `backend/scripts/generate_cards.py`
  - [x] Define card schemas

- [x] Task 2: Implement Model Card template (AC: 1, 2)
  - [x] Follow Google Model Cards format
  - [x] Include all required sections
  - [x] Add PrismIQ-specific fields

- [x] Task 3: Generate XGBoost model card (AC: 1, 2, 6)
  - [x] Model details (architecture, hyperparameters)
  - [x] Training data summary
  - [x] Performance metrics (R², MAE, RMSE)
  - [x] Intended use and limitations

- [x] Task 4: Generate Decision Tree model card (AC: 1, 2, 6)
  - [x] Model details (max_depth, etc.)
  - [x] Performance comparison
  - [x] Interpretability notes

- [x] Task 5: Generate Linear Regression model card (AC: 1, 2, 6)
  - [x] Coefficients documentation
  - [x] Baseline comparison
  - [x] Limitations

- [x] Task 6: Generate Data Card (AC: 3)
  - [x] Dataset source and description
  - [x] Feature documentation
  - [x] Statistical distributions
  - [x] Known biases and limitations

- [x] Task 7: Implement Markdown rendering (AC: 5)
  - [x] JSON to Markdown conversion
  - [x] Utility function for API
  - [x] Template-based rendering

- [x] Task 8: Write tests
  - [x] Test card generation
  - [x] Test JSON structure
  - [x] Test Markdown rendering

## Dev Notes

### Model Card Schema (Google Format)
```python
class ModelCard(BaseModel):
    # Metadata
    model_name: str
    model_version: str
    generated_at: datetime
    
    # Model Details
    model_details: ModelDetails
    
    # Intended Use
    intended_use: IntendedUse
    
    # Training Data
    training_data: TrainingDataSummary
    
    # Performance
    metrics: PerformanceMetrics
    
    # Ethical Considerations
    ethical_considerations: EthicalConsiderations
    
    # Limitations
    limitations: list[str]
    
class ModelDetails(BaseModel):
    architecture: str  # "XGBoost Gradient Boosting"
    hyperparameters: dict[str, Any]
    training_date: datetime
    framework: str  # "scikit-learn 1.5"
    
class IntendedUse(BaseModel):
    primary_use: str
    users: list[str]
    out_of_scope: list[str]
    
class PerformanceMetrics(BaseModel):
    r2_score: float
    mae: float
    rmse: float
    test_set_size: int
```

### Data Card Schema
```python
class DataCard(BaseModel):
    dataset_name: str
    version: str
    generated_at: datetime
    
    # Source
    source: DataSource
    
    # Features
    features: list[FeatureDescription]
    
    # Statistics
    statistics: DatasetStatistics
    
    # Known Issues
    known_biases: list[str]
    limitations: list[str]
    
class DataSource(BaseModel):
    origin: str  # "Kaggle Dynamic Pricing Dataset"
    collection_date: str
    preprocessing_steps: list[str]
    
class FeatureDescription(BaseModel):
    name: str
    dtype: str
    description: str
    range: str | None
    distribution: str  # "normal", "uniform", "categorical"
```

### File Locations
- Cards directory: `backend/data/cards/`
- XGBoost card: `backend/data/cards/xgboost_model_card.json`
- Decision Tree card: `backend/data/cards/decision_tree_model_card.json`
- Linear Regression card: `backend/data/cards/linear_regression_model_card.json`
- Data card: `backend/data/cards/dynamic_pricing_data_card.json`

### Markdown Rendering
```python
def render_model_card_markdown(card: ModelCard) -> str:
    return f"""
# Model Card: {card.model_name}

**Version:** {card.model_version}
**Generated:** {card.generated_at}

## Model Details

- **Architecture:** {card.model_details.architecture}
- **Framework:** {card.model_details.framework}
- **Training Date:** {card.model_details.training_date}

### Hyperparameters

{format_hyperparameters(card.model_details.hyperparameters)}

## Intended Use

{card.intended_use.primary_use}

**Target Users:** {', '.join(card.intended_use.users)}

**Out of Scope:** {', '.join(card.intended_use.out_of_scope)}

## Performance Metrics

| Metric | Value |
|--------|-------|
| R² Score | {card.metrics.r2_score:.4f} |
| MAE | {card.metrics.mae:.4f} |
| RMSE | {card.metrics.rmse:.4f} |

## Ethical Considerations

{card.ethical_considerations}

## Limitations

{format_list(card.limitations)}
"""
```

### Testing

- Test file: `backend/tests/unit/test_scripts/test_generate_cards.py`
- Test JSON file created
- Test all required fields present
- Test Markdown renders without error

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-02 | 1.0 | Initial story creation | SM Agent |
| 2025-12-02 | 1.1 | Implementation complete: Model Cards & Data Cards with tests | Dev Agent (James) |

## Dev Agent Record

### Agent Model Used
Claude Opus 4 (via Cursor)

### Debug Log References
- `ruff check scripts/generate_cards.py tests/unit/test_scripts/test_generate_cards.py` - 4 issues fixed (ternary operator, UTC alias, import sorting, unused import)
- `pytest tests/unit/test_scripts/test_generate_cards.py -v` - 20 tests passed
- `pytest -v --tb=short` - 184 tests passed (full regression)
- `python scripts/generate_cards.py` - Generated all JSON and Markdown cards

### Completion Notes List
- Implemented comprehensive Model Card and Data Card schemas following Google Model Cards format
- Created Pydantic models for all card components: ModelCard, DataCard, ModelDetails, IntendedUse, TrainingDataSummary, PerformanceMetrics, EthicalConsiderations, DataSource, FeatureDescription, DatasetStatistics
- Generated cards for all 3 models (XGBoost, Decision Tree, Linear Regression) with feature importance and coefficients where applicable
- Generated Data Card for dynamic_pricing.xlsx with full feature documentation and statistical summaries
- Implemented JSON serialization and Markdown rendering for all card types
- Cards include timestamps (generated_at) and version information as required by AC6
- All cards stored in `backend/data/cards/` with Markdown versions in `backend/data/cards/markdown/`
- 20 comprehensive tests covering schema validation, JSON structure, Markdown rendering, and card generation

### File List
**New Files:**
- `backend/scripts/generate_cards.py` - Main card generation script with schemas and rendering
- `backend/tests/unit/test_scripts/test_generate_cards.py` - Comprehensive test suite
- `backend/data/cards/xgboost_model_card.json` - XGBoost model card
- `backend/data/cards/decision_tree_model_card.json` - Decision Tree model card
- `backend/data/cards/linear_regression_model_card.json` - Linear Regression model card
- `backend/data/cards/dynamic_pricing_data_card.json` - Data card for dataset
- `backend/data/cards/markdown/xgboost_model_card.md` - XGBoost card as Markdown
- `backend/data/cards/markdown/decision_tree_model_card.md` - Decision Tree card as Markdown
- `backend/data/cards/markdown/linear_regression_model_card.md` - Linear Regression card as Markdown
- `backend/data/cards/markdown/dynamic_pricing_data_card.md` - Data card as Markdown

## QA Results

### Review Date: 2025-12-02

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Overall: Excellent** - Implementation follows Google Model Cards format with comprehensive documentation. Code is clean, well-typed, and properly structured.

**Strengths:**
- Pydantic models with proper Field descriptions and type hints
- Proper UTC timestamp handling (`datetime.now(UTC)`)
- Good separation of concerns: schemas → generation → rendering
- Comprehensive ethical considerations documented in all cards
- Both JSON and Markdown outputs generated

### Refactoring Performed

None required - code quality is high.

### Compliance Check

- Coding Standards: ✅ snake_case modules, proper imports, type hints
- Project Structure: ✅ Files in `backend/scripts/`, `backend/data/cards/`, tests in `backend/tests/unit/`
- Testing Strategy: ✅ 20 unit tests covering schemas, JSON, rendering, generation
- All ACs Met: ✅ All 6 acceptance criteria fully satisfied

### Improvements Checklist

All items addressed by the implementation:

- [x] Model Cards for all 3 models (XGBoost, Decision Tree, Linear Regression)
- [x] All required sections (model details, intended use, training data, metrics, ethical considerations, limitations)
- [x] Data Card with source, features, distributions, known biases
- [x] JSON storage in `backend/data/cards/`
- [x] Markdown rendering in `backend/data/cards/markdown/`
- [x] Timestamps and versions in all cards
- [x] Comprehensive test suite (20 tests)

### Security Review

✅ No security concerns. Cards document privacy considerations and do not contain PII.

### Performance Considerations

✅ No performance concerns. Card generation script runs in <1 second.

### Files Modified During Review

None - no modifications required.

### Gate Status

Gate: PASS → docs/qa/gates/3.4-model-data-cards.yml

### Recommended Status

✅ Ready for Done

