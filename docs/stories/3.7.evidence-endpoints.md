# Story 3.7: Evidence & Honeywell Mapping Endpoints

## Status: Draft

## Assigned To: Mario

## Story

**As a** frontend developer,
**I want** API endpoints for model/data cards and Honeywell mapping,
**so that** the Evidence tab can display documentation.

## Acceptance Criteria

1. `GET /api/v1/evidence` endpoint returns all model cards, data card, and methodology documentation
2. `GET /api/v1/honeywell_mapping` endpoint returns ride-sharing to Honeywell catalog mapping table and rationale
3. Both endpoints support response caching (long TTL - content is static)
4. Support both JSON and Markdown output formats (via Accept header or query param)
5. Documented in Swagger

## Tasks / Subtasks

- [ ] Task 1: Create evidence router (AC: 1, 2)
  - [ ] Create `backend/src/api/routers/evidence.py`
  - [ ] Register with `/api/v1` prefix

- [ ] Task 2: Create evidence schemas (AC: 1, 4)
  - [ ] Create `backend/src/schemas/evidence.py`
  - [ ] Define EvidenceResponse
  - [ ] Define HoneywellMappingResponse

- [ ] Task 3: Implement evidence endpoint (AC: 1, 3)
  - [ ] GET /api/v1/evidence
  - [ ] Load model cards from Story 3.4
  - [ ] Load data card
  - [ ] Add methodology documentation
  - [ ] Cache response (24 hour TTL)

- [ ] Task 4: Implement Honeywell mapping endpoint (AC: 2)
  - [ ] GET /api/v1/honeywell_mapping
  - [ ] Return mapping table
  - [ ] Include rationale for each mapping

- [ ] Task 5: Support multiple output formats (AC: 4)
  - [ ] Accept header: application/json vs text/markdown
  - [ ] Query param: ?format=json or ?format=markdown
  - [ ] JSON default

- [ ] Task 6: Create Honeywell mapping content (AC: 2)
  - [ ] Create `backend/data/evidence/honeywell_mapping.json`
  - [ ] Document ride-sharing to Honeywell concepts
  - [ ] Add business rationale

- [ ] Task 7: Add Swagger documentation (AC: 5)
  - [ ] Document both endpoints
  - [ ] Show example responses

- [ ] Task 8: Write tests
  - [ ] Test evidence endpoint returns cards
  - [ ] Test Honeywell mapping content
  - [ ] Test format switching

## Dev Notes

### EvidenceResponse Schema
```python
class EvidenceResponse(BaseModel):
    model_cards: list[ModelCard]
    data_card: DataCard
    methodology: MethodologyDoc
    generated_at: datetime
    cache_ttl_seconds: int = 86400  # 24 hours
    
class MethodologyDoc(BaseModel):
    title: str
    sections: list[DocSection]
    
class DocSection(BaseModel):
    heading: str
    content: str
    subsections: list[DocSection] | None = None
```

### HoneywellMappingResponse Schema
```python
class HoneywellMapping(BaseModel):
    ride_sharing_concept: str
    honeywell_equivalent: str
    category: str  # "pricing", "demand", "supply", "customer"
    rationale: str
    applicability: str
    
class HoneywellMappingResponse(BaseModel):
    title: str
    description: str
    mappings: list[HoneywellMapping]
    business_context: str
    rendered_markdown: str | None  # If format=markdown requested
```

### Honeywell Mapping Content
```json
{
  "title": "Ride-Sharing to Honeywell Enterprise Mapping",
  "description": "How dynamic pricing concepts translate to enterprise applications",
  "mappings": [
    {
      "ride_sharing_concept": "Number of Riders (Demand)",
      "honeywell_equivalent": "Product Demand Forecast",
      "category": "demand",
      "rationale": "Both represent customer demand signals that drive pricing decisions",
      "applicability": "Applicable to any product/service with variable demand"
    },
    {
      "ride_sharing_concept": "Number of Drivers (Supply)",
      "honeywell_equivalent": "Inventory/Capacity Levels",
      "category": "supply",
      "rationale": "Available supply constrains pricing flexibility",
      "applicability": "Manufacturing capacity, warehouse inventory, service availability"
    },
    {
      "ride_sharing_concept": "Surge Pricing",
      "honeywell_equivalent": "Dynamic Pricing / Premium Pricing",
      "category": "pricing",
      "rationale": "Price adjustment based on supply-demand imbalance",
      "applicability": "Energy pricing, seasonal products, high-demand periods"
    },
    {
      "ride_sharing_concept": "Customer Loyalty Tier",
      "honeywell_equivalent": "Customer Segmentation",
      "category": "customer",
      "rationale": "Different customer segments have different price sensitivity",
      "applicability": "Enterprise contracts, volume discounts, partnership tiers"
    },
    {
      "ride_sharing_concept": "Location Category",
      "honeywell_equivalent": "Market/Region Segmentation",
      "category": "pricing",
      "rationale": "Geographic factors affect pricing (costs, competition)",
      "applicability": "Regional pricing, market-specific strategies"
    },
    {
      "ride_sharing_concept": "Vehicle Type",
      "honeywell_equivalent": "Product Tier / SKU",
      "category": "pricing",
      "rationale": "Different product tiers command different prices",
      "applicability": "Product lines, service levels, feature tiers"
    }
  ],
  "business_context": "This mapping demonstrates how the ML-driven pricing concepts validated in ride-sharing can be applied to Honeywell's enterprise catalog. The same elasticity models, demand forecasting, and dynamic pricing algorithms apply to industrial products, HVAC systems, and aerospace components."
}
```

### Caching Implementation
```python
from functools import lru_cache

@lru_cache(maxsize=1)
def get_cached_evidence() -> EvidenceResponse:
    """Load and cache evidence - regenerate on restart"""
    return load_evidence_from_files()

@router.get("/evidence")
async def get_evidence(
    format: Literal["json", "markdown"] = "json"
) -> EvidenceResponse | str:
    evidence = get_cached_evidence()
    if format == "markdown":
        return render_evidence_markdown(evidence)
    return evidence
```

### File Locations
- Model cards: `backend/data/cards/*.json`
- Data card: `backend/data/cards/dynamic_pricing_data_card.json`
- Honeywell mapping: `backend/data/evidence/honeywell_mapping.json`
- Methodology: `backend/data/evidence/methodology.json`

### Testing

- Test file: `backend/tests/integration/test_api/test_evidence.py`
- Test evidence endpoint returns model_cards array
- Test Honeywell mapping has all required fields
- Test format=markdown returns string

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-02 | 1.0 | Initial story creation | SM Agent |

## Dev Agent Record

### Agent Model Used
(To be filled by Dev Agent)

### Debug Log References
(To be filled by Dev Agent)

### Completion Notes List
(To be filled by Dev Agent)

### File List
(To be filled by Dev Agent)

## QA Results
(To be filled by QA Agent)

