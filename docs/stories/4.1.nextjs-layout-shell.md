# Story 4.1: Next.js Project Setup & Layout Shell

## Status: Draft

## Assigned To: David

## Story

**As a** frontend developer,
**I want** the base application with master layout structure,
**so that** all UI work builds on a consistent foundation.

## Acceptance Criteria

1. Next.js 15+ App Router with TypeScript strict mode configured
2. Tailwind CSS 4.0 configured with custom design tokens
3. Master layout implemented with: Header, 3-panel body (left/center/right), Footer
4. Panel collapse/expand functionality working with smooth animations
5. Tab navigation working: Analyst Workspace, Executive Summary, Evidence & Methods
6. Loading states (skeleton loaders) and error boundaries implemented
7. Environment variables configured for `NEXT_PUBLIC_API_URL`

## Tasks / Subtasks

- [ ] Task 1: Configure Next.js and TypeScript (AC: 1)
  - [ ] Verify Next.js 15+ with App Router
  - [ ] Enable TypeScript strict mode in tsconfig.json
  - [ ] Configure path aliases (@/ for src/)

- [ ] Task 2: Configure Tailwind CSS (AC: 2)
  - [ ] Verify Tailwind CSS 4.0 installed
  - [ ] Create custom design tokens (colors, spacing, typography)
  - [ ] Configure dark mode support (optional)

- [ ] Task 3: Install and configure shadcn/ui (AC: 3)
  - [ ] Run shadcn/ui init
  - [ ] Install base components (Button, Card, Tabs, etc.)
  - [ ] Configure component theming

- [ ] Task 4: Create master layout structure (AC: 3)
  - [ ] Create `frontend/src/app/layout.tsx` with providers
  - [ ] Create `frontend/src/components/layout/MasterLayout.tsx`
  - [ ] Implement 3-panel grid layout (left 25%, center 50%, right 25%)

- [ ] Task 5: Implement panel components (AC: 3, 4)
  - [ ] Create `frontend/src/components/layout/Panel.tsx` base component
  - [ ] Create `LeftPanel.tsx`, `CenterPanel.tsx`, `RightPanel.tsx`
  - [ ] Implement collapse/expand with chevron toggle
  - [ ] Add smooth CSS transitions for panel resize

- [ ] Task 6: Implement tab navigation (AC: 5)
  - [ ] Create routes: `/workspace`, `/executive`, `/evidence`
  - [ ] Create `frontend/src/components/layout/TabNavigation.tsx`
  - [ ] Implement tab switching with active state
  - [ ] Preserve panel states across tab switches

- [ ] Task 7: Add loading and error states (AC: 6)
  - [ ] Create `frontend/src/components/ui/SkeletonLoader.tsx`
  - [ ] Create `frontend/src/app/error.tsx` error boundary
  - [ ] Create `frontend/src/app/loading.tsx` loading state
  - [ ] Add Suspense boundaries where needed

- [ ] Task 8: Configure environment (AC: 7)
  - [ ] Create/update `.env.local.example`
  - [ ] Set `NEXT_PUBLIC_API_URL=http://localhost:8000`
  - [ ] Create API configuration utility

- [ ] Task 9: Set up Zustand stores
  - [ ] Create `frontend/src/stores/layoutStore.ts`
  - [ ] Manage panel collapse states
  - [ ] Manage active tab state

## Dev Notes

### Project Structure (from docs/architecture/unified-project-structure.md)
```
frontend/
├── src/
│   ├── app/
│   │   ├── layout.tsx          # Root layout with providers
│   │   ├── page.tsx            # Redirect to /workspace
│   │   ├── workspace/
│   │   │   └── page.tsx        # Analyst Workspace tab
│   │   ├── executive/
│   │   │   └── page.tsx        # Executive Summary tab
│   │   └── evidence/
│   │       └── page.tsx        # Evidence & Methods tab
│   ├── components/
│   │   ├── ui/                 # shadcn/ui components
│   │   └── layout/
│   │       ├── MasterLayout.tsx
│   │       ├── Header.tsx      # Grace will implement
│   │       ├── Footer.tsx      # Grace will implement
│   │       ├── Panel.tsx
│   │       ├── LeftPanel.tsx
│   │       ├── CenterPanel.tsx
│   │       └── RightPanel.tsx
│   ├── stores/
│   │   └── layoutStore.ts
│   └── lib/
│       └── api.ts
```

### Layout Grid Structure
```tsx
// MasterLayout.tsx
<div className="min-h-screen flex flex-col">
  <Header />
  <main className="flex-1 flex">
    <LeftPanel collapsed={leftCollapsed} onToggle={toggleLeft}>
      {leftContent}
    </LeftPanel>
    <CenterPanel>
      {centerContent}
    </CenterPanel>
    <RightPanel collapsed={rightCollapsed} onToggle={toggleRight}>
      {rightContent}
    </RightPanel>
  </main>
  <Footer />
</div>
```

### Panel Collapse Animation
```tsx
// Panel.tsx
const panelVariants = {
  expanded: { width: "25%", opacity: 1 },
  collapsed: { width: "48px", opacity: 0.8 }
};

// CSS approach (preferred for performance)
.panel {
  transition: width 300ms ease-in-out;
}
.panel-collapsed {
  width: 48px;
}
.panel-expanded {
  width: 25%;
}
```

### Zustand Layout Store
```typescript
// stores/layoutStore.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface LayoutState {
  leftPanelCollapsed: boolean;
  rightPanelCollapsed: boolean;
  activeTab: 'workspace' | 'executive' | 'evidence';
  toggleLeftPanel: () => void;
  toggleRightPanel: () => void;
  setActiveTab: (tab: LayoutState['activeTab']) => void;
}

export const useLayoutStore = create<LayoutState>()(
  persist(
    (set) => ({
      leftPanelCollapsed: false,
      rightPanelCollapsed: false,
      activeTab: 'workspace',
      toggleLeftPanel: () => set((s) => ({ leftPanelCollapsed: !s.leftPanelCollapsed })),
      toggleRightPanel: () => set((s) => ({ rightPanelCollapsed: !s.rightPanelCollapsed })),
      setActiveTab: (tab) => set({ activeTab: tab }),
    }),
    { name: 'prismiq-layout' }
  )
);
```

### Design Tokens (Tailwind)
```typescript
// tailwind.config.ts
export default {
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#eff6ff',
          500: '#3b82f6',
          900: '#1e3a8a',
        },
        accent: '#10b981',
      },
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
        mono: ['JetBrains Mono', 'monospace'],
      },
    },
  },
};
```

### Testing

- Test file: `frontend/tests/unit/layout/MasterLayout.test.tsx`
- Use Bun test
- Test panel collapse/expand
- Test tab navigation
- Test responsive behavior

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-02 | 1.0 | Initial story creation | SM Agent |

## Dev Agent Record

### Agent Model Used
(To be filled by Dev Agent)

### Debug Log References
(To be filled by Dev Agent)

### Completion Notes List
(To be filled by Dev Agent)

### File List
(To be filled by Dev Agent)

## QA Results
(To be filled by QA Agent)

