# Story 4.6: Evidence & Methods Tab

## Status: Draft

## Assigned To: David

## Story

**As an** auditor,
**I want** access to methodology documentation,
**so that** I can verify the system's reliability.

## Acceptance Criteria

1. Left panel: Documentation navigation tree (Model Cards, Data Card, Methodology, Audit Trail, Downloads)
2. Center panel: Documentation Viewer rendering selected document (Markdown → HTML)
3. Right panel: Quick reference cards for models and data, Quick Actions
4. "Questions? Open Chat" button navigates to Analyst Workspace with context
5. "Email to Executives" button (mock or mailto link)
6. "Download All" button exports documentation as ZIP

## Tasks / Subtasks

- [ ] Task 1: Create evidence page structure (AC: 1, 2, 3)
  - [ ] Create `frontend/src/app/evidence/page.tsx`
  - [ ] Set up three-panel content for evidence view

- [ ] Task 2: Create Documentation Navigation (AC: 1)
  - [ ] Create `frontend/src/components/evidence/DocNavigation.tsx`
  - [ ] Tree structure with categories
  - [ ] Highlight selected document
  - [ ] Expandable/collapsible sections

- [ ] Task 3: Create Documentation Viewer (AC: 2)
  - [ ] Create `frontend/src/components/evidence/DocViewer.tsx`
  - [ ] Fetch content from `/api/v1/evidence`
  - [ ] Render Markdown using react-markdown
  - [ ] Style for readability

- [ ] Task 4: Create Quick Reference Panel (AC: 3)
  - [ ] Create `frontend/src/components/evidence/QuickReference.tsx`
  - [ ] Model summary cards (3 models)
  - [ ] Data summary card
  - [ ] Compact display format

- [ ] Task 5: Create navigation links (AC: 4)
  - [ ] "Questions? Open Chat" button
  - [ ] Navigate to /workspace with context
  - [ ] Pass selected doc topic as chat prompt

- [ ] Task 6: Create action buttons (AC: 5, 6)
  - [ ] "Email to Executives" button (mailto link)
  - [ ] "Download All" button
  - [ ] Mock or implement ZIP export

- [ ] Task 7: Create evidence service
  - [ ] Create `frontend/src/services/evidenceService.ts`
  - [ ] Fetch evidence from API
  - [ ] Cache responses

- [ ] Task 8: Integrate with API
  - [ ] Fetch from `GET /api/v1/evidence`
  - [ ] Fetch from `GET /api/v1/honeywell_mapping`
  - [ ] Handle loading and error states

## Dev Notes

### Component Structure
```
frontend/src/components/evidence/
├── EvidencePage.tsx         # Page layout
├── DocNavigation.tsx        # Left panel tree
├── DocViewer.tsx           # Center panel viewer
├── QuickReference.tsx      # Right panel cards
├── ModelCard.tsx           # Model summary card
├── DataCard.tsx            # Data summary card
└── EvidenceActions.tsx     # Action buttons
```

### Documentation Tree Structure
```typescript
const docTree = [
  {
    category: "Model Documentation",
    items: [
      { id: "xgboost", label: "XGBoost Model Card" },
      { id: "decision_tree", label: "Decision Tree Model Card" },
      { id: "linear_regression", label: "Linear Regression Model Card" },
    ]
  },
  {
    category: "Data Documentation",
    items: [
      { id: "data_card", label: "Dataset Card" },
      { id: "feature_definitions", label: "Feature Definitions" },
    ]
  },
  {
    category: "Methodology",
    items: [
      { id: "pricing_algorithm", label: "Pricing Algorithm" },
      { id: "demand_modeling", label: "Demand Modeling" },
      { id: "rules_engine", label: "Business Rules" },
    ]
  },
  {
    category: "Compliance",
    items: [
      { id: "audit_trail", label: "Audit Trail" },
      { id: "honeywell_mapping", label: "Honeywell Mapping" },
    ]
  },
];
```

### DocNavigation Component
```tsx
// DocNavigation.tsx
export function DocNavigation({ 
  selectedId, 
  onSelect 
}: { 
  selectedId: string; 
  onSelect: (id: string) => void;
}) {
  return (
    <nav className="space-y-4">
      {docTree.map((category) => (
        <div key={category.category}>
          <h3 className="font-semibold text-sm mb-2">{category.category}</h3>
          <ul className="space-y-1">
            {category.items.map((item) => (
              <li key={item.id}>
                <button
                  onClick={() => onSelect(item.id)}
                  className={cn(
                    "w-full text-left px-3 py-2 rounded text-sm",
                    selectedId === item.id 
                      ? "bg-primary-100 text-primary-700" 
                      : "hover:bg-gray-100"
                  )}
                >
                  {item.label}
                </button>
              </li>
            ))}
          </ul>
        </div>
      ))}
    </nav>
  );
}
```

### DocViewer Component
```tsx
// DocViewer.tsx
import ReactMarkdown from 'react-markdown';
import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';

export function DocViewer({ content, isLoading }: { content: string; isLoading: boolean }) {
  if (isLoading) {
    return <DocumentSkeleton />;
  }

  return (
    <article className="prose prose-slate dark:prose-invert max-w-none">
      <ReactMarkdown
        components={{
          code({ node, inline, className, children, ...props }) {
            const match = /language-(\w+)/.exec(className || '');
            return !inline && match ? (
              <SyntaxHighlighter language={match[1]} {...props}>
                {String(children).replace(/\n$/, '')}
              </SyntaxHighlighter>
            ) : (
              <code className={className} {...props}>{children}</code>
            );
          },
        }}
      >
        {content}
      </ReactMarkdown>
    </article>
  );
}
```

### Quick Reference Cards
```tsx
// QuickReference.tsx
export function QuickReference({ evidence }: { evidence: EvidenceResponse }) {
  return (
    <div className="space-y-4">
      <h3 className="font-semibold">Quick Reference</h3>
      
      {/* Model Summary Cards */}
      {evidence.model_cards.map((card) => (
        <ModelSummaryCard key={card.model_name} card={card} />
      ))}
      
      {/* Data Summary Card */}
      <DataSummaryCard card={evidence.data_card} />
      
      {/* Quick Actions */}
      <div className="pt-4 border-t space-y-2">
        <Button variant="outline" className="w-full" asChild>
          <Link href="/workspace">
            Questions? Open Chat →
          </Link>
        </Button>
        <Button variant="outline" className="w-full">
          Email to Executives
        </Button>
        <Button variant="outline" className="w-full">
          Download All (ZIP)
        </Button>
      </div>
    </div>
  );
}
```

### Evidence Service
```typescript
// services/evidenceService.ts
import ky from 'ky';

const api = ky.create({
  prefixUrl: process.env.NEXT_PUBLIC_API_URL,
});

let cachedEvidence: EvidenceResponse | null = null;

export async function getEvidence(): Promise<EvidenceResponse> {
  if (cachedEvidence) return cachedEvidence;
  
  cachedEvidence = await api.get('api/v1/evidence').json();
  return cachedEvidence;
}

export async function getHoneywellMapping(): Promise<HoneywellMappingResponse> {
  return api.get('api/v1/honeywell_mapping').json();
}
```

### Testing

- Test file: `frontend/tests/unit/evidence/DocViewer.test.tsx`
- Test Markdown rendering
- Test navigation tree selection
- Test action buttons

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-02 | 1.0 | Initial story creation | SM Agent |

## Dev Agent Record

### Agent Model Used
(To be filled by Dev Agent)

### Debug Log References
(To be filled by Dev Agent)

### Completion Notes List
(To be filled by Dev Agent)

### File List
(To be filled by Dev Agent)

## QA Results
(To be filled by QA Agent)

