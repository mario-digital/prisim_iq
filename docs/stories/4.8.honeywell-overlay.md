# Story 4.8: Honeywell Mapping Overlay

## Status: Draft

## Assigned To: Gabriel

## Story

**As a** hackathon judge,
**I want** to see the ride-sharing to Honeywell mapping,
**so that** I understand the business applicability.

## Acceptance Criteria

1. üí° toggle button in header opens modal overlay
2. Overlay displays mapping table: Ride-Sharing Concept ‚Üí Honeywell Equivalent ‚Üí Rationale
3. Close button (X) and Escape key dismiss the overlay
4. "Download PDF" button exports mapping document
5. Overlay accessible from any tab (persists across navigation)
6. Modal has proper accessibility (focus trap, aria labels)

## Tasks / Subtasks

- [ ] Task 1: Create modal component (AC: 1, 3, 6)
  - [ ] Create `frontend/src/components/honeywell/HoneywellOverlay.tsx`
  - [ ] Use shadcn/ui Dialog component
  - [ ] Implement close on X button
  - [ ] Implement close on Escape key
  - [ ] Add focus trap for accessibility
  - [ ] Add aria labels

- [ ] Task 2: Create overlay content (AC: 2)
  - [ ] Create mapping table display
  - [ ] Three columns: Ride-Sharing, Honeywell, Rationale
  - [ ] Style for readability
  - [ ] Add section header/description

- [ ] Task 3: Create toggle state (AC: 1, 5)
  - [ ] Add `isHoneywellOpen` to layout store
  - [ ] Create toggle function
  - [ ] Persist across tab navigation

- [ ] Task 4: Create Download PDF button (AC: 4)
  - [ ] Add "Download PDF" button
  - [ ] Mock implementation (or generate simple PDF)
  - [ ] Style as secondary action

- [ ] Task 5: Fetch mapping data (AC: 2)
  - [ ] Call `/api/v1/honeywell_mapping` endpoint
  - [ ] Cache response
  - [ ] Handle loading state

- [ ] Task 6: Style overlay (AC: 2)
  - [ ] Clean, professional appearance
  - [ ] Good contrast for readability
  - [ ] Responsive for different screen sizes

## Dev Notes

### Component Structure
```
frontend/src/components/honeywell/
‚îú‚îÄ‚îÄ HoneywellOverlay.tsx    # Modal container
‚îú‚îÄ‚îÄ MappingTable.tsx        # Table display
‚îî‚îÄ‚îÄ MappingRow.tsx          # Individual row
```

### HoneywellOverlay Component
```tsx
// HoneywellOverlay.tsx
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
} from '@/components/ui/dialog';
import { useLayoutStore } from '@/stores/layoutStore';
import { MappingTable } from './MappingTable';

export function HoneywellOverlay() {
  const { isHoneywellOpen, setHoneywellOpen } = useLayoutStore();
  
  return (
    <Dialog open={isHoneywellOpen} onOpenChange={setHoneywellOpen}>
      <DialogContent className="max-w-4xl max-h-[80vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle>üè≠ Ride-Sharing to Honeywell Mapping</DialogTitle>
          <DialogDescription>
            How dynamic pricing concepts translate to enterprise applications
          </DialogDescription>
        </DialogHeader>
        
        <MappingTable />
        
        <div className="flex justify-end gap-2 mt-4">
          <Button variant="outline" onClick={handleDownloadPDF}>
            Download PDF
          </Button>
          <Button onClick={() => setHoneywellOpen(false)}>
            Close
          </Button>
        </div>
      </DialogContent>
    </Dialog>
  );
}
```

### MappingTable Component
```tsx
// MappingTable.tsx
import { useEffect, useState } from 'react';
import { getHoneywellMapping } from '@/services/evidenceService';

export function MappingTable() {
  const [mapping, setMapping] = useState<HoneywellMappingResponse | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  
  useEffect(() => {
    getHoneywellMapping()
      .then(setMapping)
      .finally(() => setIsLoading(false));
  }, []);
  
  if (isLoading) {
    return <TableSkeleton />;
  }
  
  return (
    <div className="border rounded-lg overflow-hidden">
      <table className="w-full">
        <thead className="bg-muted">
          <tr>
            <th className="px-4 py-3 text-left font-medium">Ride-Sharing Concept</th>
            <th className="px-4 py-3 text-left font-medium">Honeywell Equivalent</th>
            <th className="px-4 py-3 text-left font-medium">Rationale</th>
          </tr>
        </thead>
        <tbody className="divide-y">
          {mapping?.mappings.map((row, i) => (
            <tr key={i} className="hover:bg-muted/50">
              <td className="px-4 py-3 font-medium">{row.ride_sharing_concept}</td>
              <td className="px-4 py-3">{row.honeywell_equivalent}</td>
              <td className="px-4 py-3 text-sm text-muted-foreground">
                {row.rationale}
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
```

### Layout Store Update
```typescript
// Add to stores/layoutStore.ts
interface LayoutState {
  // ... existing fields
  isHoneywellOpen: boolean;
  setHoneywellOpen: (open: boolean) => void;
}

// In the store:
isHoneywellOpen: false,
setHoneywellOpen: (isHoneywellOpen) => set({ isHoneywellOpen }),
```

### Mapping Data (Static Fallback)
```typescript
const fallbackMapping = {
  title: "Ride-Sharing to Honeywell Enterprise Mapping",
  mappings: [
    {
      ride_sharing_concept: "Number of Riders (Demand)",
      honeywell_equivalent: "Product Demand Forecast",
      rationale: "Both represent customer demand signals that drive pricing decisions"
    },
    {
      ride_sharing_concept: "Number of Drivers (Supply)",
      honeywell_equivalent: "Inventory/Capacity Levels",
      rationale: "Available supply constrains pricing flexibility"
    },
    {
      ride_sharing_concept: "Surge Pricing",
      honeywell_equivalent: "Dynamic Pricing / Premium Pricing",
      rationale: "Price adjustment based on supply-demand imbalance"
    },
    {
      ride_sharing_concept: "Customer Loyalty Tier",
      honeywell_equivalent: "Customer Segmentation",
      rationale: "Different segments have different price sensitivity"
    },
    {
      ride_sharing_concept: "Location Category",
      honeywell_equivalent: "Market/Region Segmentation",
      rationale: "Geographic factors affect pricing"
    },
    {
      ride_sharing_concept: "Vehicle Type",
      honeywell_equivalent: "Product Tier / SKU",
      rationale: "Different product tiers command different prices"
    },
  ]
};
```

### Accessibility Requirements
- Focus trap within modal (Dialog handles this)
- `aria-labelledby` pointing to title
- `aria-describedby` pointing to description
- Close on Escape key (Dialog handles this)
- Return focus to trigger button on close

### Download PDF (Mock Implementation)
```typescript
function handleDownloadPDF() {
  // For hackathon: simple mock
  const content = mapping?.mappings.map(m => 
    `${m.ride_sharing_concept} ‚Üí ${m.honeywell_equivalent}\n${m.rationale}\n`
  ).join('\n---\n');
  
  const blob = new Blob([content || ''], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'honeywell-mapping.txt';
  a.click();
}
```

### Testing

- Test file: `frontend/tests/unit/honeywell/HoneywellOverlay.test.tsx`
- Test modal opens on toggle
- Test modal closes on X, Escape, and overlay click
- Test table renders mapping data
- Test download button triggers download

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-02 | 1.0 | Initial story creation | SM Agent |

## Dev Agent Record

### Agent Model Used
(To be filled by Dev Agent)

### Debug Log References
(To be filled by Dev Agent)

### Completion Notes List
(To be filled by Dev Agent)

### File List
(To be filled by Dev Agent)

## QA Results
(To be filled by QA Agent)

